const fs = require("fs");
const path = require("path");

const imagesDir = path.join(__dirname, "public/images/wallpaper");
const contentFile = path.join(__dirname, "public/content.js");

// Get all image files (jpg, png, gif, webp)
const imageFiles = fs.readdirSync(imagesDir).filter((f) => /\.(png|jpe?g|gif|webp)$/i.test(f));

// Convert list to JS array
const imageList = JSON.stringify(imageFiles, null, 2);

// Generate the JS file
const result = `
// Auto-generated by generate-image-list.js
const imageFolder = "images/wallpaper/";
const imageList = ${imageList};

function getRandomImage() {
  if (imageList.length === 0) return "";
  const index = Math.floor(Math.random() * imageList.length);
  return imageFolder + imageList[index];
}

function setBackgroundImage(src) {
  const img = document.createElement("img");
  img.src = src;
  img.alt = "Wallpaper";
  img.style.position = "fixed";
  img.style.top = "0";
  img.style.left = "0";
  img.style.width = "100vw";
  img.style.height = "100vh";
  img.style.objectFit = "cover";
  img.style.zIndex = "-1";
  img.style.userSelect = "none";
  img.style.pointerEvents = "none";
  document.body.appendChild(img);
}

window.addEventListener("DOMContentLoaded", () => {
  const src = getRandomImage();
  if (src) {
    setBackgroundImage(src);
  }
});
`;

fs.writeFileSync(contentFile, result, "utf-8");
console.log(`âœ… Updated content.js with ${imageFiles.length} image(s).`);
